var e=(e,s,a)=>new Promise((r,m)=>{var t=e=>{try{c(a.next(e))}catch(s){m(s)}},l=e=>{try{c(a.throw(e))}catch(s){m(s)}},c=e=>e.done?r(e.value):Promise.resolve(e.value).then(t,l);c((a=a.apply(e,s)).next())});import{q as s,u as a,a8 as r,j as m,l as t,a9 as l,C as c,e as i,t as o,d as n,y as u}from"./index-Ctx_GovF.js";import{r as d}from"./react-vendor-DBmefE3i.js";import{b as N}from"./helpers-B6CJClH3.js";import"./icons-DYE8NDaX.js";import"./utils-CZ_YNEkO.js";function h(){const{error:h,success:x}=s(),{user:b}=a(),[f,j]=d.useState(null),[p,C]=d.useState(""),[y,D]=d.useState(!1),[v,g]=d.useState(!0),w=d.useRef(null),E=d.useRef(null);d.useEffect(()=>{U();const e=setInterval(()=>{(null==f?void 0:f._id)&&U()},3e3);return()=>clearInterval(e)},[]),d.useEffect(()=>{V()},[null==f?void 0:f.messages]);const V=()=>{var e;null==(e=w.current)||e.scrollIntoView({behavior:"smooth"})},U=()=>e(this,null,function*(){try{const e=yield r.getMyChat();j(e.data.chat)}catch(e){h("فشل تحميل المحادثة")}finally{g(!1)}});return v?m.jsxDEV("div",{className:"flex items-center justify-center py-20",children:m.jsxDEV(t,{className:"animate-spin text-xl md:text-2xl text-primary-600"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:80,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:79,columnNumber:7},this):m.jsxDEV("div",{className:"h-full flex flex-col",children:[m.jsxDEV("div",{className:"card mb-4",children:m.jsxDEV("div",{className:"flex items-center gap-3",children:[m.jsxDEV("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:m.jsxDEV(l,{className:"text-primary-600 text-xl"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:91,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:90,columnNumber:11},this),m.jsxDEV("div",{children:[m.jsxDEV("h1",{className:"text-lg font-bold",children:"الدردشة مع الدعم"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:94,columnNumber:13},this),m.jsxDEV("p",{className:"text-sm text-gray-600",children:(null==f?void 0:f.admin)?`محادثة مع ${f.admin.name}`:"في انتظار رد الفريق"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:95,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:93,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:89,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:88,columnNumber:7},this),m.jsxDEV("div",{ref:E,className:"flex-1 card overflow-y-auto mb-4",style:{maxHeight:"calc(100vh - 300px)"},children:(null==f?void 0:f.messages)&&f.messages.length>0?m.jsxDEV("div",{className:"space-y-4 py-4",children:[f.messages.map((e,s)=>{const a="user"===e.sender,r=e.read;return m.jsxDEV("div",{className:"flex "+(a?"justify-end":"justify-start"),children:m.jsxDEV("div",{className:"flex items-start gap-2 max-w-[75%] "+(a?"flex-row-reverse":"flex-row"),children:[m.jsxDEV("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 "+(a?"bg-primary-100":"bg-gray-100"),children:a?m.jsxDEV(c,{className:"text-primary-600"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:124,columnNumber:25},this):m.jsxDEV(i,{className:"text-gray-600"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:126,columnNumber:25},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:120,columnNumber:21},this),m.jsxDEV("div",{className:"flex flex-col "+(a?"items-end":"items-start"),children:[m.jsxDEV("div",{className:"px-4 py-2 rounded-lg "+(a?"bg-primary-600 text-white":"bg-gray-100 text-gray-900"),children:m.jsxDEV("p",{className:"whitespace-pre-wrap break-words",children:e.message},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:135,columnNumber:25},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:130,columnNumber:23},this),m.jsxDEV("div",{className:"flex items-center gap-1 mt-1 text-xs text-gray-500",children:[a&&m.jsxDEV(m.Fragment,{children:r?m.jsxDEV(o,{className:"text-blue-500"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:141,columnNumber:31},this):m.jsxDEV(n,{},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:143,columnNumber:31},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:139,columnNumber:27},this),m.jsxDEV("span",{children:N(e.createdAt||new Date)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:147,columnNumber:25},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:137,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:129,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:119,columnNumber:19},this)},s,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:115,columnNumber:17},this)}),m.jsxDEV("div",{ref:w},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:154,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:109,columnNumber:11},this):m.jsxDEV("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[m.jsxDEV(l,{className:"text-4xl text-gray-300 mb-4"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:158,columnNumber:13},this),m.jsxDEV("p",{className:"text-gray-600 mb-2",children:"لا توجد رسائل بعد"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:159,columnNumber:13},this),m.jsxDEV("p",{className:"text-sm text-gray-500",children:"ابدأ المحادثة بإرسال رسالة"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:160,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:157,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:103,columnNumber:7},this),m.jsxDEV("form",{onSubmit:s=>e(this,null,function*(){var e,a;if(s.preventDefault(),p.trim()&&!y){D(!0);try{const e=null==f?void 0:f._id,s=yield r.sendMessage(e,p.trim());j(s.data.chat),C(""),x("تم إرسال الرسالة")}catch(m){h((null==(a=null==(e=m.response)?void 0:e.data)?void 0:a.message)||"فشل إرسال الرسالة")}finally{D(!1)}}}),className:"card",children:m.jsxDEV("div",{className:"flex items-center gap-2",children:[m.jsxDEV("input",{type:"text",value:p,onChange:e=>C(e.target.value),placeholder:"اكتب رسالتك هنا...",className:"input-field flex-1",disabled:y},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:168,columnNumber:11},this),m.jsxDEV("button",{type:"submit",disabled:y||!p.trim(),className:"btn-primary flex items-center gap-2 px-4",children:y?m.jsxDEV(m.Fragment,{children:[m.jsxDEV(t,{className:"animate-spin"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:183,columnNumber:17},this),m.jsxDEV("span",{className:"hidden sm:inline",children:"جاري الإرسال..."},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:184,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:182,columnNumber:15},this):m.jsxDEV(m.Fragment,{children:[m.jsxDEV(u,{},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:188,columnNumber:17},this),m.jsxDEV("span",{className:"hidden sm:inline",children:"إرسال"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:189,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:187,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:176,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:167,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:166,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/Chat.jsx",lineNumber:86,columnNumber:5},this)}export{h as default};
