var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,i=(s,a,r)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[a]=r,n=(e,s)=>{for(var a in s||(s={}))l.call(s,a)&&i(e,a,s[a]);if(r)for(var a of r(s))m.call(s,a)&&i(e,a,s[a]);return e},t=(e,r)=>s(e,a(r)),d=(e,s,a)=>new Promise((r,l)=>{var m=e=>{try{n(a.next(e))}catch(s){l(s)}},i=e=>{try{n(a.throw(e))}catch(s){l(s)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(m,i);n((a=a.apply(e,s)).next())});import{q as c,I as o,s as u,V as N,ad as x,j as b,l as p,J as h,a3 as g,d as j,D,ae as y,r as v,t as f,A as w,g as C,S as O,af as E,Q as U}from"./index-b47YYOPl.js";import{b as V,r as S}from"./react-vendor-DBmefE3i.js";import{g as k,a as _,b as P,f as I}from"./helpers-B6CJClH3.js";import"./icons-DYE8NDaX.js";import"./utils-CZ_YNEkO.js";const $=[{value:"pending",label:"قيد الانتظار"},{value:"confirmed",label:"مؤكد"},{value:"processing",label:"قيد المعالجة"},{value:"purchased",label:"تم الشراء"},{value:"shipped",label:"تم الشحن"},{value:"in_transit",label:"قيد التوصيل"},{value:"arrived",label:"وصل"},{value:"arrived_at_point",label:"وصل لنقطة التسليم"},{value:"ready_for_pickup",label:"جاهز للاستلام"},{value:"delivered",label:"تم التسليم"},{value:"cancelled",label:"ملغي"},{value:"agent_pending",label:"قيد الانتظار (وكيل)"},{value:"agent_confirmed",label:"مؤكد من الوكيل"},{value:"agent_processing",label:"قيد المعالجة (وكيل)"}];function M(){var e,s,a,r,l;const m=V(),{success:i,error:M}=c(),[A,R]=S.useState([]),[F,L]=S.useState(!0),[Y,q]=S.useState([]),[z,T]=S.useState("all"),[B,J]=S.useState(""),[Q,G]=S.useState(null),[H,K]=S.useState(null),[W,X]=S.useState(!1),[Z,ee]=S.useState(""),[se,ae]=S.useState(""),[re,le]=S.useState(!1),[me,ie]=S.useState(null),[ne,te]=S.useState([]),[de,ce]=S.useState(!1),[oe,ue]=S.useState(""),[Ne,xe]=S.useState(!1),[be,pe]=S.useState({}),[he,ge]=S.useState(!1),[je,De]=S.useState(null),[ye,ve]=S.useState({paymentMethod:"",paymentDate:(new Date).toISOString().split("T")[0],transactionId:"",proofUrl:"",notes:""}),[fe,we]=S.useState(!1),[Ce,Oe]=S.useState(null),[Ee,Ue]=S.useState(!1),[Ve,Se]=S.useState({}),[ke,_e]=S.useState(null);S.useEffect(()=>{$e(),Pe()},[]),S.useEffect(()=>{Fe()},[A,z,B]);const Pe=()=>d(this,null,function*(){try{ce(!0);const e=yield o.getAll({page:1,limit:100,status:"active"});te(e.data.points||[])}catch(e){}finally{ce(!1)}}),Ie=e=>{var s,a,r;ie(e),ue((null==(a=null==(s=e.delivery)?void 0:s.pickupPoint)?void 0:a._id)||(null==(r=e.delivery)?void 0:r.pickupPoint)||""),le(!0)},$e=()=>d(this,null,function*(){try{const[e,s]=yield Promise.all([u.getAll().catch(()=>({data:{orders:[]}})),N.getAll().catch(()=>({data:{orders:[]}}))]),a=[...(e.data.orders||[]).map(e=>t(n({},e),{type:"regular"})),...(s.data.orders||[]).map(e=>t(n({},e),{type:"smartCart"}))].sort((e,s)=>new Date(s.createdAt)-new Date(e.createdAt));R(a);const r={},l=a.filter(e=>{var s,a;return"agent"===(null==(s=e.metadata)?void 0:s.source)&&(null==(a=e.metadata)?void 0:a.agentOrderId)}).map(e=>d(this,null,function*(){var s;try{const a=yield x.getOrder(e.metadata.agentId,e.metadata.agentOrderId);(null==(s=a.data)?void 0:s.order)&&(r[e._id]=a.data.order)}catch(a){}}));yield Promise.all(l),pe(r),yield Me(a)}catch(e){}finally{L(!1)}}),Me=e=>d(this,null,function*(){Se({})}),Ae=e=>d(this,null,function*(){var s;if(void 0!==Ve[e])return Ve[e];try{const a=yield E.getByOrder(e);if(null==(s=a.data)?void 0:s.data)return Se(s=>t(n({},s),{[e]:a.data.data})),a.data.data}catch(a){Se(s=>t(n({},s),{[e]:null}))}return null}),Re=e=>d(this,null,function*(){var s,a;try{_e(e._id);const s=yield E.create({orderId:e._id,taxRate:0,taxIncluded:!1,companyInfo:{name:"Olivia Ship - أوليفيا شيب",address:"صنعاء، اليمن",phone:"+967 777 123 456",email:"info@oliviaship.com"},notes:"شكراً لتعاملكم معنا"});Se(a=>t(n({},a),{[e._id]:s.data.data})),i("تم إنشاء الفاتورة بنجاح"),m("/admin/invoices")}catch(r){M((null==(a=null==(s=r.response)?void 0:s.data)?void 0:a.message)||"فشل في إنشاء الفاتورة")}finally{_e(null)}}),Fe=()=>{let e=[...A];if("all"!==z&&(e=e.filter(e=>e.status===z)),B){const s=B.toLowerCase();e=e.filter(e=>{var a,r,l,m,i,n,t,d;return(null==(a=e.orderNumber)?void 0:a.toLowerCase().includes(s))||(null==(l=null==(r=e.user)?void 0:r.name)?void 0:l.toLowerCase().includes(s))||(null==(i=null==(m=e.user)?void 0:m.email)?void 0:i.toLowerCase().includes(s))||"regular"===e.type&&(null==(t=null==(n=e.product)?void 0:n.name)?void 0:t.toLowerCase().includes(s))||"smartCart"===e.type&&(null==(d=e.products)?void 0:d.some(e=>{var a;return null==(a=e.name)?void 0:a.toLowerCase().includes(s)}))})}q(e)},Le=e=>{K(e),ee(e.status),ae(""),X(!0)},Ye=e=>d(this,null,function*(){var s,a,r,l,m;if(De(e),ve({paymentMethod:"",paymentDate:(new Date).toISOString().split("T")[0],transactionId:"",proofUrl:"",notes:""}),Oe(null),null==(s=e.metadata)?void 0:s.agentId)try{Ue(!0);const s=yield x.getOne(e.metadata.agentId);if(null==(l=null==(r=null==(a=s.data)?void 0:a.agent)?void 0:r.user)?void 0:l._id){const e=s.data.agent.user._id;try{const s=yield U.getByUserId(e);(null==(m=s.data)?void 0:m.wallet)&&Oe(s.data.wallet)}catch(i){}}}catch(i){}finally{Ue(!1)}ge(!0)}),qe=e=>{switch(e){case"paid":return"bg-green-100 text-green-700";case"partial":return"bg-yellow-100 text-yellow-700";case"pending":default:return"bg-gray-100 text-gray-700";case"refunded":return"bg-red-100 text-red-700"}},ze=e=>{switch(e){case"paid":return"مدفوع";case"partial":return"جزئي";case"pending":return"معلق";case"refunded":return"مسترد";default:return"غير محدد"}};return F?b.jsxDEV("div",{className:"flex items-center justify-center py-20",children:b.jsxDEV(p,{className:"animate-spin text-xl md:text-2xl text-primary-600"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:417,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:416,columnNumber:7},this):b.jsxDEV("div",{children:[b.jsxDEV("div",{className:"mb-6",children:[b.jsxDEV("h1",{className:"text-xl font-bold mb-2 text-gradient",children:"إدارة الطلبات"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:426,columnNumber:9},this),b.jsxDEV("p",{className:"text-gray-600 text-sm",children:"عرض وإدارة جميع طلبات العملاء"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:427,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:425,columnNumber:7},this),b.jsxDEV("div",{className:"card mb-6",children:b.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[b.jsxDEV("div",{className:"relative",children:[b.jsxDEV(h,{className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:435,columnNumber:13},this),b.jsxDEV("input",{type:"text",value:B,onChange:e=>J(e.target.value),placeholder:"ابحث برقم الطلب أو اسم العميل...",className:"input-field pr-12 w-full"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:436,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:434,columnNumber:11},this),b.jsxDEV("div",{className:"relative",children:[b.jsxDEV(g,{className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:447,columnNumber:13},this),b.jsxDEV("select",{value:z,onChange:e=>T(e.target.value),className:"input-field pr-12 w-full appearance-none cursor-pointer",children:[b.jsxDEV("option",{value:"all",children:"جميع الحالات"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:453,columnNumber:15},this),$.map(e=>b.jsxDEV("option",{value:e.value,children:e.label},e.value,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:455,columnNumber:17},this))]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:448,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:446,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:432,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:431,columnNumber:7},this),b.jsxDEV("div",{className:"mb-4",children:b.jsxDEV("p",{className:"text-gray-600",children:["إجمالي الطلبات: ",b.jsxDEV("span",{className:"font-bold text-primary-600",children:Y.length},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:467,columnNumber:27},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:466,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:465,columnNumber:7},this),Y.length>0?b.jsxDEV(b.Fragment,{children:[b.jsxDEV("div",{className:"hidden lg:block card overflow-x-auto",children:b.jsxDEV("table",{className:"w-full",children:[b.jsxDEV("thead",{children:b.jsxDEV("tr",{className:"border-b border-gray-200",children:[b.jsxDEV("th",{className:"text-right py-4 px-4 font-bold text-gray-700",children:"رقم الطلب"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:479,columnNumber:19},this),b.jsxDEV("th",{className:"text-right py-4 px-4 font-bold text-gray-700",children:"العميل"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:480,columnNumber:19},this),b.jsxDEV("th",{className:"text-right py-4 px-4 font-bold text-gray-700",children:"المنتج"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:481,columnNumber:19},this),b.jsxDEV("th",{className:"text-right py-4 px-4 font-bold text-gray-700",children:"الحالة"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:482,columnNumber:19},this),b.jsxDEV("th",{className:"text-right py-4 px-4 font-bold text-gray-700",children:"دفع العميل"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:483,columnNumber:19},this),b.jsxDEV("th",{className:"text-right py-4 px-4 font-bold text-gray-700",children:"دفع الوكيل"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:484,columnNumber:19},this),b.jsxDEV("th",{className:"text-right py-4 px-4 font-bold text-gray-700",children:"التاريخ"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:485,columnNumber:19},this),b.jsxDEV("th",{className:"text-right py-4 px-4 font-bold text-gray-700",children:"الإجمالي"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:486,columnNumber:19},this),b.jsxDEV("th",{className:"text-right py-4 px-4 font-bold text-gray-700",children:"إجراءات"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:487,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:478,columnNumber:17},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:477,columnNumber:15},this),b.jsxDEV("tbody",{children:Y.map(e=>{var s,a,r,l,i,n,t,d,c,o;const u="smartCart"===e.type?e.products&&e.products.length>0?`${e.products[0].name}${e.products.length>1?` + ${e.products.length-1} منتج آخر`:""}`:"منتجات متعددة":(null==(s=e.product)?void 0:s.name)||"منتج غير محدد",N="smartCart"===e.type?(null==(a=e.products)?void 0:a.length)||0:1,x=(null==(r=e.pricing)?void 0:r.totalInYER)||(null==(l=e.pricing)?void 0:l.totalCost)||0,h="agent"===(null==(i=e.metadata)?void 0:i.source),g=h?null==(n=e.metadata)?void 0:n.customerName:null==(t=e.user)?void 0:t.name,C=h?null==(d=e.metadata)?void 0:d.customerPhone:null==(c=e.user)?void 0:c.email,O=h?be[e._id]:null;return b.jsxDEV("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors",children:[b.jsxDEV("td",{className:"py-4 px-4",children:b.jsxDEV("div",{className:"flex items-center gap-2",children:[b.jsxDEV("span",{className:"font-mono font-semibold text-primary-600",children:["#",e.orderNumber]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:514,columnNumber:27},this),h&&b.jsxDEV("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-600 text-xs font-medium rounded",children:"وكيل"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:516,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:513,columnNumber:25},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:512,columnNumber:23},this),b.jsxDEV("td",{className:"py-4 px-4",children:b.jsxDEV("div",{children:[b.jsxDEV("p",{className:"font-semibold",children:g||"غير محدد"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:524,columnNumber:27},this),b.jsxDEV("p",{className:"text-sm text-gray-500",children:C||(null==(o=e.user)?void 0:o.email)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:525,columnNumber:27},this),h&&e.user&&b.jsxDEV("p",{className:"text-xs text-gray-400 mt-1",children:["وكيل: ",e.user.name]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:527,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:523,columnNumber:25},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:522,columnNumber:23},this),b.jsxDEV("td",{className:"py-4 px-4",children:b.jsxDEV("div",{className:"flex flex-col max-w-xs",children:[b.jsxDEV("span",{className:"truncate font-medium",children:u},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:535,columnNumber:27},this),"smartCart"===e.type&&N>1&&b.jsxDEV("span",{className:"text-xs text-gray-500 mt-1",children:["(",N," منتج)"]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:537,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:534,columnNumber:25},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:533,columnNumber:23},this),b.jsxDEV("td",{className:"py-4 px-4",children:b.jsxDEV("button",{onClick:()=>Le(e),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all hover:shadow-md ${_(e.status)}`,title:"انقر لتغيير الحالة",children:k(e.status)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:544,columnNumber:25},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:543,columnNumber:23},this),b.jsxDEV("td",{className:"py-4 px-4",children:h&&O?b.jsxDEV("span",{className:`px-2 py-1 rounded text-xs font-medium ${qe(O.customerPaymentStatus)}`,children:ze(O.customerPaymentStatus)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:554,columnNumber:27},this):b.jsxDEV("span",{className:"text-gray-400 text-xs",children:"-"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:558,columnNumber:27},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:552,columnNumber:23},this),b.jsxDEV("td",{className:"py-4 px-4",children:h&&O?b.jsxDEV("div",{className:"flex items-center gap-2",children:[b.jsxDEV("span",{className:`px-2 py-1 rounded text-xs font-medium ${qe(O.agentPaymentStatus)}`,children:ze(O.agentPaymentStatus)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:564,columnNumber:29},this),"paid"!==O.agentPaymentStatus&&b.jsxDEV("button",{onClick:()=>Ye(e),className:"p-1 text-green-600 hover:bg-green-50 rounded transition-colors",title:"تسجيل دفع الوكيل",children:b.jsxDEV(j,{},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:573,columnNumber:33},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:568,columnNumber:31},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:563,columnNumber:27},this):b.jsxDEV("span",{className:"text-gray-400 text-xs",children:"-"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:578,columnNumber:27},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:561,columnNumber:23},this),b.jsxDEV("td",{className:"py-4 px-4 text-gray-600",children:P(e.createdAt)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:581,columnNumber:23},this),b.jsxDEV("td",{className:"py-4 px-4",children:b.jsxDEV("span",{className:"font-bold text-primary-600",children:I(x,"YER")},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:583,columnNumber:25},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:582,columnNumber:23},this),b.jsxDEV("td",{className:"py-4 px-4",children:b.jsxDEV("div",{className:"flex items-center gap-2",children:[b.jsxDEV("button",{onClick:()=>m(`/dashboard/orders/${e._id}`),className:"p-2 text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"عرض التفاصيل",children:b.jsxDEV(D,{},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:594,columnNumber:29},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:589,columnNumber:27},this),b.jsxDEV("button",{onClick:()=>Le(e),className:"p-2 text-secondary-600 hover:bg-secondary-50 rounded-lg transition-colors",title:"تغيير الحالة",children:b.jsxDEV(y,{},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:601,columnNumber:29},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:596,columnNumber:27},this),b.jsxDEV("button",{onClick:()=>Ie(e),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"توزيع على نقطة",children:b.jsxDEV(v,{},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:608,columnNumber:29},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:603,columnNumber:27},this),Ve[e._id]?b.jsxDEV("button",{onClick:()=>m("/admin/invoices"),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"عرض الفاتورة",children:b.jsxDEV(f,{},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:616,columnNumber:31},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:611,columnNumber:29},this):null===Ve[e._id]?b.jsxDEV("button",{onClick:()=>Re(e),disabled:ke===e._id,className:"p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition-colors disabled:opacity-50",title:"إنشاء فاتورة",children:ke===e._id?b.jsxDEV(p,{className:"animate-spin"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:626,columnNumber:33},this):b.jsxDEV(w,{},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:628,columnNumber:33},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:619,columnNumber:29},this):b.jsxDEV("button",{onClick:()=>Ae(e._id),className:"p-2 text-gray-400 hover:bg-gray-50 rounded-lg transition-colors",title:"التحقق من الفاتورة",children:b.jsxDEV(w,{},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:637,columnNumber:31},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:632,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:588,columnNumber:25},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:587,columnNumber:23},this)]},e._id,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:511,columnNumber:21},this)})},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:490,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:476,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:475,columnNumber:11},this),b.jsxDEV("div",{className:"lg:hidden space-y-4",children:Y.map(e=>{var s,a,r,l,i,n,t,d,c,o;const u="smartCart"===e.type?e.products&&e.products.length>0?`${e.products[0].name}${e.products.length>1?` + ${e.products.length-1} منتج آخر`:""}`:"منتجات متعددة":(null==(s=e.product)?void 0:s.name)||"منتج غير محدد",N="smartCart"===e.type?(null==(a=e.products)?void 0:a.length)||0:1,x=(null==(r=e.pricing)?void 0:r.totalInYER)||(null==(l=e.pricing)?void 0:l.totalCost)||0,p="agent"===(null==(i=e.metadata)?void 0:i.source),h=p?null==(n=e.metadata)?void 0:n.customerName:null==(t=e.user)?void 0:t.name,g=p?null==(d=e.metadata)?void 0:d.customerPhone:null==(c=e.user)?void 0:c.email,y=p?be[e._id]:null;return b.jsxDEV("div",{className:"card",children:[b.jsxDEV("div",{className:"flex items-start justify-between mb-4",children:[b.jsxDEV("div",{className:"flex-1",children:[b.jsxDEV("div",{className:"flex items-center gap-2 mb-1",children:[b.jsxDEV("p",{className:"font-mono font-bold text-primary-600",children:["#",e.orderNumber]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:675,columnNumber:25},this),p&&b.jsxDEV("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-600 text-xs font-medium rounded",children:"وكيل"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:677,columnNumber:27},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:674,columnNumber:23},this),b.jsxDEV("p",{className:"text-sm text-gray-500",children:P(e.createdAt)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:682,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:673,columnNumber:21},this),b.jsxDEV("button",{onClick:()=>Le(e),className:`px-3 py-1.5 rounded-lg text-xs font-medium ${_(e.status)}`,children:k(e.status)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:684,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:672,columnNumber:19},this),b.jsxDEV("div",{className:"mb-4",children:[b.jsxDEV("p",{className:"text-sm text-gray-500 mb-1",children:"العميل"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:693,columnNumber:21},this),b.jsxDEV("p",{className:"font-semibold",children:h||"غير محدد"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:694,columnNumber:21},this),b.jsxDEV("p",{className:"text-xs text-gray-500",children:g||(null==(o=e.user)?void 0:o.email)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:695,columnNumber:21},this),p&&e.user&&b.jsxDEV("p",{className:"text-xs text-gray-400 mt-1",children:["وكيل: ",e.user.name]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:697,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:692,columnNumber:19},this),b.jsxDEV("div",{className:"mb-4",children:[b.jsxDEV("p",{className:"text-sm text-gray-500 mb-1",children:"المنتج"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:704,columnNumber:21},this),b.jsxDEV("p",{className:"font-medium",children:u},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:705,columnNumber:21},this),"smartCart"===e.type&&N>1&&b.jsxDEV("p",{className:"text-xs text-gray-500 mt-1",children:["(",N," منتج)"]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:707,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:703,columnNumber:19},this),p&&y&&b.jsxDEV("div",{className:"mb-4 grid grid-cols-2 gap-4 pt-4 border-t border-gray-200",children:[b.jsxDEV("div",{children:[b.jsxDEV("p",{className:"text-sm text-gray-500 mb-1",children:"دفع العميل"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:714,columnNumber:25},this),b.jsxDEV("span",{className:`px-2 py-1 rounded text-xs font-medium ${qe(y.customerPaymentStatus)}`,children:ze(y.customerPaymentStatus)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:715,columnNumber:25},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:713,columnNumber:23},this),b.jsxDEV("div",{children:[b.jsxDEV("p",{className:"text-sm text-gray-500 mb-1",children:"دفع الوكيل"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:720,columnNumber:25},this),b.jsxDEV("div",{className:"flex items-center gap-2",children:[b.jsxDEV("span",{className:`px-2 py-1 rounded text-xs font-medium ${qe(y.agentPaymentStatus)}`,children:ze(y.agentPaymentStatus)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:722,columnNumber:27},this),"paid"!==y.agentPaymentStatus&&b.jsxDEV("button",{onClick:()=>Ye(e),className:"p-1 text-green-600 hover:bg-green-50 rounded transition-colors",title:"تسجيل دفع الوكيل",children:b.jsxDEV(j,{},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:731,columnNumber:31},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:726,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:721,columnNumber:25},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:719,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:712,columnNumber:21},this),b.jsxDEV("div",{className:"mb-4 flex items-center justify-between pt-4 border-t border-gray-200",children:[b.jsxDEV("div",{children:[b.jsxDEV("p",{className:"text-sm text-gray-500 mb-1",children:"الإجمالي"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:741,columnNumber:23},this),b.jsxDEV("p",{className:"text-lg font-bold text-primary-600",children:I(x,"YER")},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:742,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:740,columnNumber:21},this),b.jsxDEV("div",{className:"flex gap-2",children:[b.jsxDEV("button",{onClick:()=>m(`/dashboard/orders/${e._id}`),className:"btn-primary px-4 py-2 text-sm",children:[b.jsxDEV(D,{className:"ml-2"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:751,columnNumber:25},this),"عرض التفاصيل"]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:747,columnNumber:23},this),b.jsxDEV("button",{onClick:()=>Ie(e),className:"px-4 py-2 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors",children:[b.jsxDEV(v,{className:"ml-2"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:758,columnNumber:25},this),"توزيع على نقطة"]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:754,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:746,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:739,columnNumber:19},this)]},e._id,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:671,columnNumber:17},this)})},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:650,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:473,columnNumber:9},this):b.jsxDEV("div",{className:"card text-center py-16",children:[b.jsxDEV(C,{className:"text-3xl md:text-4xl text-gray-300 mx-auto mb-4"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:770,columnNumber:11},this),b.jsxDEV("p",{className:"text-sm md:text-base text-gray-600 mb-2",children:"لا توجد طلبات"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:771,columnNumber:11},this),b.jsxDEV("p",{className:"text-gray-500",children:B||"all"!==z?"جرب تغيير معايير البحث":"لم يتم إنشاء أي طلبات بعد"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:772,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:769,columnNumber:9},this),W&&H&&b.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:b.jsxDEV("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6",children:[b.jsxDEV("h2",{className:"text-lg font-bold mb-4",children:"تغيير حالة الطلب"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:784,columnNumber:13},this),b.jsxDEV("div",{className:"mb-4",children:b.jsxDEV("p",{className:"text-sm text-gray-600 mb-2",children:["رقم الطلب: ",b.jsxDEV("span",{className:"font-bold",children:["#",H.orderNumber]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:787,columnNumber:68},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:787,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:786,columnNumber:13},this),b.jsxDEV("div",{className:"mb-4",children:[b.jsxDEV("label",{className:"block text-sm font-semibold mb-2",children:"الحالة الجديدة"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:791,columnNumber:15},this),b.jsxDEV("select",{value:Z,onChange:e=>ee(e.target.value),className:"input-field w-full",children:$.map(e=>b.jsxDEV("option",{value:e.value,children:e.label},e.value,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:798,columnNumber:19},this))},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:792,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:790,columnNumber:13},this),b.jsxDEV("div",{className:"mb-6",children:[b.jsxDEV("label",{className:"block text-sm font-semibold mb-2",children:"ملاحظة (اختياري)"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:806,columnNumber:15},this),b.jsxDEV("textarea",{value:se,onChange:e=>ae(e.target.value),placeholder:"أضف ملاحظة حول تغيير الحالة...",className:"input-field w-full min-h-[100px]"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:807,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:805,columnNumber:13},this),b.jsxDEV("div",{className:"flex gap-3",children:[b.jsxDEV("button",{onClick:()=>{X(!1),K(null),ee(""),ae("")},className:"flex-1 btn-secondary",children:[b.jsxDEV(O,{className:"ml-2"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:825,columnNumber:17},this),"إلغاء"]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:816,columnNumber:15},this),b.jsxDEV("button",{onClick:()=>d(this,null,function*(){var e,s;if(H&&Z){G(H._id);try{const e="regular"===H.type?u:N;yield e.updateStatus(H._id,{status:Z,note:se}),yield $e(),X(!1),K(null),i("✅ تم تحديث حالة الطلب بنجاح")}catch(a){M((null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.message)||"فشل في تحديث الحالة")}finally{G(null)}}}),disabled:Q===H._id||!Z,className:"flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:Q===H._id?b.jsxDEV(b.Fragment,{children:[b.jsxDEV(p,{className:"animate-spin ml-2"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:835,columnNumber:21},this),"جاري التحديث..."]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:834,columnNumber:19},this):b.jsxDEV(b.Fragment,{children:[b.jsxDEV(j,{className:"ml-2"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:840,columnNumber:21},this),"حفظ"]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:839,columnNumber:19},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:828,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:815,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:783,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:782,columnNumber:9},this),he&&je&&b.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:b.jsxDEV("div",{className:"bg-white rounded-xl shadow-2xl max-w-lg w-full p-6",children:[b.jsxDEV("h2",{className:"text-lg font-bold mb-4",children:"تسجيل دفع الوكيل"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:854,columnNumber:13},this),b.jsxDEV("div",{className:"mb-4",children:[b.jsxDEV("p",{className:"text-sm text-gray-600 mb-2",children:["رقم الطلب: ",b.jsxDEV("span",{className:"font-bold",children:["#",je.orderNumber]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:858,columnNumber:28},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:857,columnNumber:15},this),(null==(e=je.metadata)?void 0:e.customerName)&&b.jsxDEV("p",{className:"text-sm text-gray-600",children:["العميل: ",b.jsxDEV("span",{className:"font-medium",children:je.metadata.customerName},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:862,columnNumber:27},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:861,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:856,columnNumber:13},this),b.jsxDEV("div",{className:"mb-4",children:[b.jsxDEV("label",{className:"block text-sm font-semibold mb-2",children:"طريقة الدفع *"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:868,columnNumber:15},this),b.jsxDEV("select",{value:ye.paymentMethod,onChange:e=>ve(t(n({},ye),{paymentMethod:e.target.value})),className:"input-field w-full",required:!0,children:[b.jsxDEV("option",{value:"",children:"-- اختر طريقة الدفع --"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:875,columnNumber:17},this),b.jsxDEV("option",{value:"wallet",children:"محفظة"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:876,columnNumber:17},this),b.jsxDEV("option",{value:"transfer",children:"تحويل بنكي"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:877,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:869,columnNumber:15},this),"wallet"===ye.paymentMethod&&Ce&&b.jsxDEV("div",{className:"mt-2 p-3 bg-blue-50 rounded-lg",children:[b.jsxDEV("p",{className:"text-sm text-blue-700",children:["الرصيد المتاح: ",b.jsxDEV("span",{className:"font-bold",children:I(Ce.balance||0,Ce.currency||"SAR")},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:882,columnNumber:36},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:881,columnNumber:19},this),je&&b.jsxDEV("p",{className:"text-xs text-blue-600 mt-1",children:["المبلغ المطلوب: ",I(((null==(s=je.pricing)?void 0:s.totalCost)||0)-((null==(a=be[je._id])?void 0:a.commission)||0),"SAR")]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:885,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:880,columnNumber:17},this),"wallet"===ye.paymentMethod&&Ee&&b.jsxDEV("div",{className:"mt-2 flex items-center gap-2 text-sm text-gray-600",children:[b.jsxDEV(p,{className:"animate-spin"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:896,columnNumber:19},this),"جاري تحميل رصيد المحفظة..."]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:895,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:867,columnNumber:13},this),b.jsxDEV("div",{className:"mb-4",children:[b.jsxDEV("label",{className:"block text-sm font-semibold mb-2",children:"تاريخ الدفع"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:903,columnNumber:15},this),b.jsxDEV("input",{type:"date",value:ye.paymentDate,onChange:e=>ve(t(n({},ye),{paymentDate:e.target.value})),className:"input-field w-full"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:904,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:902,columnNumber:13},this),"transfer"===ye.paymentMethod&&b.jsxDEV("div",{className:"mb-4",children:[b.jsxDEV("label",{className:"block text-sm font-semibold mb-2",children:"رقم العملية *"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:914,columnNumber:17},this),b.jsxDEV("input",{type:"text",value:ye.transactionId,onChange:e=>ve(t(n({},ye),{transactionId:e.target.value})),placeholder:"رقم التحويل أو المرجع",className:"input-field w-full",required:!0},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:915,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:913,columnNumber:15},this),"wallet"===ye.paymentMethod&&b.jsxDEV("div",{className:"mb-4 p-3 bg-green-50 rounded-lg",children:b.jsxDEV("p",{className:"text-sm text-green-800",children:[b.jsxDEV(f,{className:"inline ml-2"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:928,columnNumber:19},this),"سيتم خصم المبلغ تلقائياً من محفظة الوكيل"]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:927,columnNumber:17},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:926,columnNumber:15},this),b.jsxDEV("div",{className:"mb-4",children:[b.jsxDEV("label",{className:"block text-sm font-semibold mb-2",children:"رابط إيصال الدفع (اختياري)"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:935,columnNumber:15},this),b.jsxDEV("input",{type:"url",value:ye.proofUrl,onChange:e=>ve(t(n({},ye),{proofUrl:e.target.value})),placeholder:"https://...",className:"input-field w-full"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:936,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:934,columnNumber:13},this),b.jsxDEV("div",{className:"mb-6",children:[b.jsxDEV("label",{className:"block text-sm font-semibold mb-2",children:"ملاحظات (اختياري)"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:946,columnNumber:15},this),b.jsxDEV("textarea",{value:ye.notes,onChange:e=>ve(t(n({},ye),{notes:e.target.value})),placeholder:"ملاحظات إضافية...",rows:3,className:"input-field w-full"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:947,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:945,columnNumber:13},this),b.jsxDEV("div",{className:"flex gap-3",children:[b.jsxDEV("button",{onClick:()=>{ge(!1),De(null)},className:"btn-secondary flex-1",disabled:fe,children:"إلغاء"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:957,columnNumber:15},this),b.jsxDEV("button",{onClick:()=>d(this,null,function*(){var e,s,a,r,l;if(je&&ye.paymentMethod)if("transfer"!==ye.paymentMethod||ye.transactionId){if("wallet"===ye.paymentMethod){const s=be[je._id],a=((null==(e=je.pricing)?void 0:e.totalCost)||0)-((null==s?void 0:s.commission)||0);if(!Ce)return void M("فشل في تحميل رصيد المحفظة. يرجى المحاولة مرة أخرى");if(Ce.balance<a)return void M(`رصيد المحفظة غير كافي. الرصيد المتاح: ${I(Ce.balance,Ce.currency||"SAR")}`)}we(!0);try{const e=null==(s=je.metadata)?void 0:s.agentId,r=null==(a=je.metadata)?void 0:a.agentOrderId;if(!e||!r)return void M("معلومات الطلب غير صحيحة");yield x.markAgentPayment(e,r,{paymentMethod:ye.paymentMethod,paymentDate:ye.paymentDate,transactionId:ye.transactionId||void 0,proofUrl:ye.proofUrl||void 0,notes:ye.notes||void 0}),i("✅ تم تسجيل دفع الوكيل بنجاح"),ge(!1),De(null),Oe(null),yield $e()}catch(m){M((null==(l=null==(r=m.response)?void 0:r.data)?void 0:l.message)||"فشل في تسجيل الدفع")}finally{we(!1)}}else M("يرجى إدخال رقم العملية للتحويل البنكي");else M("يرجى إدخال طريقة الدفع")}),className:"btn-primary flex-1",disabled:fe,children:fe?b.jsxDEV(b.Fragment,{children:[b.jsxDEV(p,{className:"animate-spin ml-2"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:974,columnNumber:21},this),"جاري الحفظ..."]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:973,columnNumber:19},this):b.jsxDEV(b.Fragment,{children:[b.jsxDEV(j,{className:"ml-2"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:979,columnNumber:21},this),"تسجيل الدفع"]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:978,columnNumber:19},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:967,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:956,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:853,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:852,columnNumber:9},this),re&&me&&b.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:b.jsxDEV("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6",children:[b.jsxDEV("h2",{className:"text-lg font-bold mb-4",children:"توزيع الطلب على نقطة استلام"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:993,columnNumber:13},this),b.jsxDEV("div",{className:"mb-4",children:[b.jsxDEV("p",{className:"text-sm text-gray-600 mb-2",children:["رقم الطلب: ",b.jsxDEV("span",{className:"font-bold",children:["#",me.orderNumber]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:997,columnNumber:28},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:996,columnNumber:15},this),b.jsxDEV("p",{className:"text-sm text-gray-600",children:["العميل: ",b.jsxDEV("span",{className:"font-medium",children:null==(r=me.user)?void 0:r.name},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1e3,columnNumber:25},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:999,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:995,columnNumber:13},this),b.jsxDEV("div",{className:"mb-6",children:[b.jsxDEV("label",{className:"block text-sm font-semibold mb-2",children:"اختر النقطة"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1005,columnNumber:15},this),de?b.jsxDEV("div",{className:"flex justify-center py-4",children:b.jsxDEV(p,{className:"animate-spin text-lg md:text-xl text-primary-600"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1008,columnNumber:19},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1007,columnNumber:17},this):0===ne.length?b.jsxDEV("p",{className:"text-sm text-gray-500 py-4",children:"لا توجد نقاط متاحة"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1011,columnNumber:17},this):b.jsxDEV("select",{value:oe,onChange:e=>ue(e.target.value),className:"input-field w-full",children:[b.jsxDEV("option",{value:"",children:"-- اختر النقطة --"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1018,columnNumber:19},this),ne.map(e=>b.jsxDEV("option",{value:e._id,children:[e.name," - ",e.location.city," (",e.location.address,")"]},e._id,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1020,columnNumber:21},this))]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1013,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1004,columnNumber:13},this),(null==(l=me.delivery)?void 0:l.pickupPoint)&&b.jsxDEV("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:b.jsxDEV("p",{className:"text-sm text-blue-700",children:["النقطة الحالية: ",b.jsxDEV("span",{className:"font-medium",children:"object"==typeof me.delivery.pickupPoint?me.delivery.pickupPoint.name:"نقطة معينة"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1031,columnNumber:35},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1030,columnNumber:17},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1029,columnNumber:15},this),b.jsxDEV("div",{className:"flex gap-3",children:[b.jsxDEV("button",{onClick:()=>{le(!1),ie(null),ue("")},className:"flex-1 btn-secondary",children:[b.jsxDEV(O,{className:"ml-2"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1049,columnNumber:17},this),"إلغاء"]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1041,columnNumber:15},this),b.jsxDEV("button",{onClick:()=>d(this,null,function*(){var e,s;if(me&&oe){xe(!0);try{const e="regular"===me.type?u:N;yield e.assignToPoint(me._id,oe),i("✅ تم توزيع الطلب على النقطة بنجاح"),le(!1),ie(null),ue(""),yield $e()}catch(a){M((null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.message)||"فشل في توزيع الطلب على النقطة")}finally{xe(!1)}}}),disabled:Ne||!oe||de,className:"flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:Ne?b.jsxDEV(b.Fragment,{children:[b.jsxDEV(p,{className:"animate-spin ml-2"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1059,columnNumber:21},this),"جاري التوزيع..."]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1058,columnNumber:19},this):b.jsxDEV(b.Fragment,{children:[b.jsxDEV(j,{className:"ml-2"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1064,columnNumber:21},this),"توزيع"]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1063,columnNumber:19},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1052,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:1040,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:992,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:991,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/Orders.jsx",lineNumber:423,columnNumber:5},this)}export{M as default};
