var e=(e,s,a)=>new Promise((i,m)=>{var n=e=>{try{r(a.next(e))}catch(s){m(s)}},l=e=>{try{r(a.throw(e))}catch(s){m(s)}},r=e=>e.done?i(e.value):Promise.resolve(e.value).then(n,l);r((a=a.apply(e,s)).next())});import{q as s,a8 as a,j as i,l as m,J as n,C as l,a9 as r,S as t,e as c,t as d,y as o}from"./index-Ctx_GovF.js";import{r as u}from"./react-vendor-DBmefE3i.js";import{b as N}from"./helpers-B6CJClH3.js";import"./icons-DYE8NDaX.js";import"./utils-CZ_YNEkO.js";function h(){var h,x;const{error:b,success:j}=s(),[f,p]=u.useState([]),[C,v]=u.useState(null),[y,D]=u.useState(""),[g,w]=u.useState(!1),[A,E]=u.useState(!0),[V,U]=u.useState(""),_=u.useRef(null);u.useEffect(()=>{k();const e=setInterval(()=>{k(),(null==C?void 0:C._id)&&F()},2e3);return()=>clearInterval(e)},[]),u.useEffect(()=>{(null==C?void 0:C._id)&&F()},[null==C?void 0:C._id]),u.useEffect(()=>{S()},[null==C?void 0:C.messages]);const S=()=>{var e;null==(e=_.current)||e.scrollIntoView({behavior:"smooth"})},k=()=>e(this,null,function*(){try{const e={};V&&(e.search=V);const s=yield a.getAllChats(e);if(p(s.data.chats||[]),null==C?void 0:C._id){const e=s.data.chats.find(e=>e._id===C._id);e&&v(e)}}catch(e){}finally{E(!1)}}),F=()=>e(this,null,function*(){if(null==C?void 0:C._id)try{const e=yield a.getChat(C._id);v(e.data.chat),p(s=>s.map(s=>s._id===C._id?e.data.chat:s))}catch(e){}}),I=s=>e(this,null,function*(){try{const e=yield a.getChat(s._id);v(e.data.chat)}catch(e){b("فشل تحميل المحادثة")}}),H=f.reduce((e,s)=>{var a;return e+((null==(a=s.unreadCount)?void 0:a.admin)||0)},0);return A?i.jsxDEV("div",{className:"flex items-center justify-center py-20",children:i.jsxDEV(m,{className:"animate-spin text-xl md:text-2xl text-primary-600"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:132,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:131,columnNumber:7},this):i.jsxDEV("div",{className:"h-full flex gap-4",children:[i.jsxDEV("div",{className:"w-80 flex-shrink-0",children:[i.jsxDEV("div",{className:"card mb-4",children:[i.jsxDEV("div",{className:"flex items-center justify-between mb-4",children:[i.jsxDEV("h2",{className:"text-lg font-bold",children:"المحادثات"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:143,columnNumber:13},this),H>0&&i.jsxDEV("span",{className:"bg-primary-600 text-white text-xs px-2 py-1 rounded-full",children:H},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:145,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:142,columnNumber:11},this),i.jsxDEV("div",{className:"relative",children:[i.jsxDEV(n,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:151,columnNumber:13},this),i.jsxDEV("input",{type:"text",value:V,onChange:e=>U(e.target.value),placeholder:"ابحث في المحادثات...",className:"input-field pr-10 w-full"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:152,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:150,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:141,columnNumber:9},this),i.jsxDEV("div",{className:"card overflow-y-auto",style:{maxHeight:"calc(100vh - 200px)"},children:f.length>0?i.jsxDEV("div",{className:"space-y-2",children:f.map(e=>{var s,a,m,n;const r=null==(s=e.messages)?void 0:s[e.messages.length-1],t=(null==(a=e.unreadCount)?void 0:a.admin)||0,c=(null==C?void 0:C._id)===e._id;return i.jsxDEV("div",{onClick:()=>I(e),className:"p-3 rounded-lg cursor-pointer transition-colors "+(c?"bg-primary-50 border-2 border-primary-500":"hover:bg-gray-50 border-2 border-transparent"),children:[i.jsxDEV("div",{className:"flex items-start justify-between gap-2",children:[i.jsxDEV("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[i.jsxDEV("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0",children:i.jsxDEV(l,{className:"text-primary-600"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:183,columnNumber:27},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:182,columnNumber:25},this),i.jsxDEV("div",{className:"flex-1 min-w-0",children:[i.jsxDEV("p",{className:"font-semibold text-sm truncate",children:(null==(m=e.user)?void 0:m.name)||"عميل"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:186,columnNumber:27},this),i.jsxDEV("p",{className:"text-xs text-gray-500 truncate",children:null==(n=e.user)?void 0:n.email},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:187,columnNumber:27},this),r&&i.jsxDEV("p",{className:"text-xs text-gray-600 mt-1 truncate",children:r.message},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:189,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:185,columnNumber:25},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:181,columnNumber:23},this),t>0&&i.jsxDEV("span",{className:"bg-primary-600 text-white text-xs px-2 py-0.5 rounded-full flex-shrink-0",children:t},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:196,columnNumber:25},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:180,columnNumber:21},this),r&&i.jsxDEV("p",{className:"text-xs text-gray-400 mt-2",children:N(e.lastMessageAt)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:202,columnNumber:23},this)]},e._id,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:171,columnNumber:19},this)})},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:164,columnNumber:13},this):i.jsxDEV("div",{className:"text-center py-12",children:[i.jsxDEV(r,{className:"text-3xl text-gray-300 mx-auto mb-4"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:212,columnNumber:15},this),i.jsxDEV("p",{className:"text-sm text-gray-600",children:"لا توجد محادثات"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:213,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:211,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:162,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:140,columnNumber:7},this),i.jsxDEV("div",{className:"flex-1 flex flex-col",children:C?i.jsxDEV(i.Fragment,{children:[i.jsxDEV("div",{className:"card mb-4",children:i.jsxDEV("div",{className:"flex items-center justify-between",children:[i.jsxDEV("div",{className:"flex items-center gap-3",children:[i.jsxDEV("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:i.jsxDEV(l,{className:"text-primary-600"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:228,columnNumber:21},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:227,columnNumber:19},this),i.jsxDEV("div",{children:[i.jsxDEV("h3",{className:"font-bold",children:(null==(h=C.user)?void 0:h.name)||"عميل"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:231,columnNumber:21},this),i.jsxDEV("p",{className:"text-sm text-gray-600",children:null==(x=C.user)?void 0:x.email},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:232,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:230,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:226,columnNumber:17},this),i.jsxDEV("button",{onClick:()=>v(null),className:"p-2 hover:bg-gray-100 rounded-lg",children:i.jsxDEV(t,{},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:239,columnNumber:19},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:235,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:225,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:224,columnNumber:13},this),i.jsxDEV("div",{className:"flex-1 card overflow-y-auto mb-4",style:{maxHeight:"calc(100vh - 300px)"},children:C.messages&&C.messages.length>0?i.jsxDEV("div",{className:"space-y-4 py-4",children:[C.messages.map((e,s)=>{const a="admin"===e.sender;return i.jsxDEV("div",{className:"flex "+(a?"justify-end":"justify-start"),children:i.jsxDEV("div",{className:"flex items-start gap-2 max-w-[75%] "+(a?"flex-row-reverse":"flex-row"),children:[i.jsxDEV("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 "+(a?"bg-primary-100":"bg-gray-100"),children:a?i.jsxDEV(c,{className:"text-primary-600"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:264,columnNumber:31},this):i.jsxDEV(l,{className:"text-gray-600"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:266,columnNumber:31},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:260,columnNumber:27},this),i.jsxDEV("div",{className:"flex flex-col "+(a?"items-end":"items-start"),children:[i.jsxDEV("div",{className:"px-4 py-2 rounded-lg "+(a?"bg-primary-600 text-white":"bg-gray-100 text-gray-900"),children:i.jsxDEV("p",{className:"whitespace-pre-wrap break-words",children:e.message},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:275,columnNumber:31},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:270,columnNumber:29},this),i.jsxDEV("div",{className:"flex items-center gap-1 mt-1 text-xs text-gray-500",children:[i.jsxDEV("span",{children:N(e.createdAt||new Date)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:278,columnNumber:31},this),a&&e.read&&i.jsxDEV(d,{className:"text-blue-500"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:280,columnNumber:33},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:277,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:269,columnNumber:27},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:259,columnNumber:25},this)},s,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:255,columnNumber:23},this)}),i.jsxDEV("div",{ref:_},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:288,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:250,columnNumber:17},this):i.jsxDEV("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[i.jsxDEV(r,{className:"text-4xl text-gray-300 mb-4"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:292,columnNumber:19},this),i.jsxDEV("p",{className:"text-gray-600 mb-2",children:"لا توجد رسائل بعد"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:293,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:291,columnNumber:17},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:245,columnNumber:13},this),i.jsxDEV("form",{onSubmit:s=>e(this,null,function*(){var e,i;if(s.preventDefault(),y.trim()&&!g&&C){w(!0);try{const e=yield a.sendMessage(C._id,y.trim());v(e.data.chat),D(""),p(s=>s.map(s=>s._id===C._id?e.data.chat:s)),j("تم إرسال الرسالة")}catch(m){b((null==(i=null==(e=m.response)?void 0:e.data)?void 0:i.message)||"فشل إرسال الرسالة")}finally{w(!1)}}}),className:"card",children:i.jsxDEV("div",{className:"flex items-center gap-2",children:[i.jsxDEV("input",{type:"text",value:y,onChange:e=>D(e.target.value),placeholder:"اكتب ردك هنا...",className:"input-field flex-1",disabled:g},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:301,columnNumber:17},this),i.jsxDEV("button",{type:"submit",disabled:g||!y.trim(),className:"btn-primary flex items-center gap-2 px-4",children:g?i.jsxDEV(i.Fragment,{children:[i.jsxDEV(m,{className:"animate-spin"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:316,columnNumber:23},this),i.jsxDEV("span",{className:"hidden sm:inline",children:"جاري الإرسال..."},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:317,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:315,columnNumber:21},this):i.jsxDEV(i.Fragment,{children:[i.jsxDEV(o,{},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:321,columnNumber:23},this),i.jsxDEV("span",{className:"hidden sm:inline",children:"إرسال"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:322,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:320,columnNumber:21},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:309,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:300,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:299,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:222,columnNumber:11},this):i.jsxDEV("div",{className:"card flex items-center justify-center h-full",children:i.jsxDEV("div",{className:"text-center",children:[i.jsxDEV(r,{className:"text-4xl text-gray-300 mx-auto mb-4"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:332,columnNumber:15},this),i.jsxDEV("p",{className:"text-gray-600",children:"اختر محادثة من القائمة"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:333,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:331,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:330,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:220,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/admin/AdminChat.jsx",lineNumber:138,columnNumber:5},this)}export{h as default};
