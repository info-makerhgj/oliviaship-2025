var e=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,l=(s,r,a)=>r in s?e(s,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[r]=a,c=(e,s)=>{for(var r in s||(s={}))t.call(s,r)&&l(e,r,s[r]);if(a)for(var r of a(s))m.call(s,r)&&l(e,r,s[r]);return e},o=(e,a)=>s(e,r(a)),i=(e,s,r)=>new Promise((a,t)=>{var m=e=>{try{c(r.next(e))}catch(s){t(s)}},l=e=>{try{c(r.throw(e))}catch(s){t(s)}},c=e=>e.done?a(e.value):Promise.resolve(e.value).then(m,l);c((r=r.apply(e,s)).next())});import{k as d,U as n,o as u,S as x,j as N,f as p,G as y,d as b,A as h}from"./index-Dfjzp2DE.js";import{b as j,e as v,r as f,L as g}from"./react-vendor-DBmefE3i.js";import{c as D,g as w,a as O,b as C,f as E}from"./helpers-B6CJClH3.js";import"./icons-DYE8NDaX.js";import"./utils-CZ_YNEkO.js";function U(){const e=j(),{success:s,error:r,warning:a,info:t}=d(),[m,l]=v(),[U,M]=f.useState([]),[V,S]=f.useState(!0),[P,k]=f.useState(""),[A,q]=f.useState("all"),[I,_]=f.useState(!1);f.useEffect(()=>{$()},[A]),f.useEffect(()=>{const e=m.get("payment"),s=m.get("session_id");"success"===e&&s?L(s):"cancelled"===e&&(a("تم إلغاء عملية الدفع."),l({}))},[]);const L=(m,c=0)=>i(this,null,function*(){_(!0);try{const o=yield n.verifySession(m);if(o.data.success&&o.data.paid&&o.data.orderId)s("✅ تم الدفع بنجاح! تم إنشاء الطلب."),l({}),yield $(),e(`/dashboard/orders/${o.data.orderId}`,{replace:!0});else if(o.data.paid&&!o.data.orderId)c<3?setTimeout(()=>L(m,c+1),2e3):(t("تم الدفع بنجاح، لكن الطلب قيد الإنشاء. يرجى تحديث الصفحة لاحقاً."),l({}),yield $());else{const e=o.data.paymentStatus||"unknown";"unpaid"===e||"no_payment_required"===e?r("❌ لم يتم الدفع. يرجى المحاولة مرة أخرى."):a(`⚠️ حالة الدفع: ${e}. يرجى التحقق من الطلبات لاحقاً.`),l({}),yield $()}}catch(o){c<2?setTimeout(()=>L(m,c+1),1e3):(a("⚠️ فشل التحقق من حالة الدفع. يرجى التحقق من الطلبات يدوياً."),l({}),yield $())}finally{_(!1)}}),$=()=>i(this,null,function*(){try{const e={};"all"!==A&&(e.status=A);const[s,r]=yield Promise.all([u.getAll(e).catch(()=>({data:{orders:[]}})),x.getAll(e).catch(()=>({data:{orders:[]}}))]),a=[...(s.data.orders||[]).map(e=>o(c({},e),{type:"regular"})),...(r.data.orders||[]).map(e=>o(c({},e),{type:"smartCart"}))].sort((e,s)=>new Date(s.createdAt)-new Date(e.createdAt));M(a)}catch(e){}finally{S(!1)}}),R=U.filter(e=>{var s,r,a;if(P){const t=P.toLowerCase();return(null==(s=e.orderNumber)?void 0:s.toLowerCase().includes(t))||(null==(a=null==(r=e.product)?void 0:r.name)?void 0:a.toLowerCase().includes(t))}return!0});return V||I?N.jsxDEV("div",{className:"flex flex-col items-center justify-center py-20",children:[N.jsxDEV(p,{className:"animate-spin text-4xl text-primary-600 mb-4"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:134,columnNumber:9},this),N.jsxDEV("p",{className:"text-gray-600",children:I?"جارٍ التحقق من حالة الدفع...":"جاري التحميل..."},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:135,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:133,columnNumber:7},this):N.jsxDEV("div",{children:[N.jsxDEV("div",{className:"mb-4 sm:mb-6",children:[N.jsxDEV("h1",{className:"text-lg sm:text-xl font-bold mb-1 sm:mb-2 text-gradient",children:"طلباتي"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:146,columnNumber:9},this),N.jsxDEV("p",{className:"text-gray-600 text-xs sm:text-sm",children:"عرض ومتابعة جميع طلباتك"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:147,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:145,columnNumber:7},this),N.jsxDEV("div",{className:"card mb-4 sm:mb-6 p-3 sm:p-4 md:p-6",children:[N.jsxDEV("div",{className:"mb-3 sm:mb-4",children:N.jsxDEV("div",{className:"relative",children:[N.jsxDEV(y,{className:"absolute right-2 sm:right-3 md:right-4 top-1/2 transform -translate-y-1/2 text-gray-400 text-sm sm:text-base"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:155,columnNumber:13},this),N.jsxDEV("input",{type:"text",value:P,onChange:e=>k(e.target.value),placeholder:"ابحث برقم الطلب أو اسم المنتج...",className:"input-field pr-8 sm:pr-10 md:pr-12 text-sm sm:text-base py-2 sm:py-2.5 px-3"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:156,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:154,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:153,columnNumber:9},this),N.jsxDEV("div",{children:[N.jsxDEV("label",{className:"block mb-1.5 sm:mb-2 font-semibold text-xs sm:text-sm",children:"التصفية حسب الحالة:"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:168,columnNumber:11},this),N.jsxDEV("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:[{value:"all",label:"الكل"},{value:"pending",label:"قيد الانتظار"},{value:"processing",label:"قيد المعالجة"},{value:"shipped",label:"تم الشحن"},{value:"delivered",label:"مكتمل"}].map(e=>N.jsxDEV("button",{onClick:()=>q(e.value),className:"px-2.5 sm:px-3 md:px-4 py-1.5 sm:py-2 rounded-lg sm:rounded-xl text-xs sm:text-sm font-medium transition-all "+(A===e.value?"bg-primary-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.label},e.value,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:171,columnNumber:15},this))},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:169,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:167,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:151,columnNumber:7},this),R.length>0?N.jsxDEV("div",{className:"space-y-3",children:R.map(e=>{var s,r,a,t,m,l,c,o,i,d,n,u,x,p;const y=(null==(s=e.product)?void 0:s.image)||(null==(a=null==(r=e.products)?void 0:r[0])?void 0:a.image),j=(null==(t=e.product)?void 0:t.name)||(null==(l=null==(m=e.products)?void 0:m[0])?void 0:l.name)||"منتج غير محدد",v=(null==(c=e.product)?void 0:c.store)||(null==(i=null==(o=e.products)?void 0:o[0])?void 0:i.store),f=(null==(d=e.products)?void 0:d.length)||1,U=e.products?e.products.reduce((e,s)=>e+(s.quantity||1),0):(null==(n=e.product)?void 0:n.quantity)||1,M=(null==(u=e.pricing)?void 0:u.totalInYER)||(null==(x=e.pricing)?void 0:x.totalCost)||0;return N.jsxDEV(g,{to:`/dashboard/orders/${e._id}`,className:"block",children:N.jsxDEV("div",{className:"card p-4",children:N.jsxDEV("div",{className:"flex gap-3",children:[y&&N.jsxDEV("div",{className:"flex-shrink-0",children:N.jsxDEV("img",{src:y,alt:j,className:"w-20 h-20 md:w-24 md:h-24 object-cover rounded-lg border border-gray-200",onError:e=>{e.target.src=D(200,200)}},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:212,columnNumber:25},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:211,columnNumber:23},this),N.jsxDEV("div",{className:"flex-1 min-w-0",children:[N.jsxDEV("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[N.jsxDEV("span",{className:"font-bold text-xs md:text-sm text-primary-600",children:["#",e.orderNumber]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:227,columnNumber:25},this),N.jsxDEV("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${O(e.status)}`,children:w(e.status)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:230,columnNumber:25},this),e.products&&f>1&&N.jsxDEV("span",{className:"px-2 py-0.5 bg-secondary-100 text-secondary-700 rounded text-xs font-medium",children:[f," منتج"]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:234,columnNumber:27},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:226,columnNumber:23},this),N.jsxDEV("h3",{className:"font-semibold text-sm md:text-base mb-2 line-clamp-2 break-words",title:j,children:[j,e.products&&f>1&&N.jsxDEV("span",{className:"text-gray-500 text-xs mr-1",children:["+ ",f-1," منتج آخر"]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:247,columnNumber:27},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:241,columnNumber:23},this),N.jsxDEV("div",{className:"flex flex-wrap items-center gap-2 mb-3 text-xs text-gray-600",children:[v&&N.jsxDEV("span",{className:"px-2 py-0.5 bg-primary-100 text-primary-700 rounded text-xs font-medium",children:v},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:254,columnNumber:27},this),N.jsxDEV("span",{className:"flex items-center gap-1",children:[N.jsxDEV(b,{className:"text-xs"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:259,columnNumber:27},this),C(e.createdAt)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:258,columnNumber:25},this),"smartCart"===e.type?N.jsxDEV("span",{children:["إجمالي: ",U," قطعة"]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:263,columnNumber:27},this):(null==(p=e.product)?void 0:p.quantity)&&N.jsxDEV("span",{children:["الكمية: ",e.product.quantity]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:266,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:252,columnNumber:23},this),N.jsxDEV("div",{className:"flex items-center justify-between pt-2 border-t border-gray-200",children:[N.jsxDEV("div",{className:"flex items-center gap-1 text-primary-600 text-xs font-medium",children:[N.jsxDEV(h,{className:"text-sm"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:275,columnNumber:27},this),N.jsxDEV("span",{children:"عرض التفاصيل"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:276,columnNumber:27},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:274,columnNumber:25},this),e.pricing&&N.jsxDEV("div",{className:"text-left",children:[N.jsxDEV("p",{className:"text-gray-500 text-xs mb-0.5",children:"الإجمالي"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:282,columnNumber:29},this),N.jsxDEV("p",{className:"text-base md:text-lg font-bold text-primary-600",children:E(M,"YER")},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:283,columnNumber:29},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:281,columnNumber:27},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:272,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:224,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:208,columnNumber:19},this)},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:207,columnNumber:17},this)},e._id,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:202,columnNumber:15},this)})},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:189,columnNumber:9},this):N.jsxDEV("div",{className:"card text-center py-16",children:[N.jsxDEV(b,{className:"text-6xl text-gray-300 mx-auto mb-4"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:298,columnNumber:11},this),N.jsxDEV("p",{className:"text-sm md:text-base text-gray-600 mb-2",children:P||"all"!==A?"لا توجد نتائج":"لا توجد طلبات بعد"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:299,columnNumber:11},this),!P&&"all"===A&&N.jsxDEV(g,{to:"/order",className:"btn-primary inline-flex items-center gap-2 mt-4",children:"طلب منتج الآن"},void 0,!1,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:303,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:297,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/cct33/Downloads/2yam/src/pages/customer/MyOrders.jsx",lineNumber:143,columnNumber:5},this)}export{U as default};
