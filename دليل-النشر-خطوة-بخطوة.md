# ๐ ุฏููู ุงููุดุฑ ุนูู AWS Lightsail - ุฎุทูุฉ ุจุฎุทูุฉ

## ๐ฏ ุงููุฏู
ูุดุฑ ุงูุชุญุฏูุซุงุช (ุฅุตูุงุญ CORS) ูู ุฌูุงุฒู ุฅูู ุณูุฑูุฑ AWS Lightsail

---

## ๐ ุงููุชุทูุจุงุช

ูุจู ุงูุจุฏุกุ ุชุฃูุฏ ุฅู ุนูุฏู:
- โ Git ูุซุจุช ุนูู ุฌูุงุฒู
- โ SSH Key ูููุตูู ุฅูู AWS Lightsail
- โ IP Address ููุณูุฑูุฑ
- โ ุงุณู ุงููุณุชุฎุฏู (ุนุงุฏุฉ `ubuntu`)

---

## ๐ ุงูุทุฑููุฉ ุงูุฃููู: ุงููุดุฑ ุงููุฏูู (ุงูุฃุณูู)

### ุงูุฎุทูุฉ 1: ุฑูุน ุงูุชุญุฏูุซุงุช ุฅูู GitHub

ุงูุชุญ Command Prompt ุฃู PowerShell ูู ูุฌูุฏ ุงููุดุฑูุน ูุดุบู:

```bash
# 1. ุฅุถุงูุฉ ุฌููุน ุงูุชุบููุฑุงุช
git add .

# 2. ุญูุธ ุงูุชุบููุฑุงุช ูุน ุฑุณุงูุฉ
git commit -m "fix: Remove duplicate CORS headers"

# 3. ุฑูุน ุงูุชุญุฏูุซุงุช ุฅูู GitHub
git push origin main
```

**ููุงุญุธุฉ:** ุฅุฐุง ุทูุจ ููู username/passwordุ ุงุณุชุฎุฏู Personal Access Token ูู GitHub

---

### ุงูุฎุทูุฉ 2: ุงูุงุชุตุงู ุจุงูุณูุฑูุฑ ุนุจุฑ SSH

#### ุนูู Windows (PowerShell):
```powershell
ssh -i "C:\path\to\your-key.pem" ubuntu@YOUR_SERVER_IP
```

#### ูุซุงู:
```powershell
ssh -i "C:\Users\YourName\Downloads\oliviaship-key.pem" ubuntu@18.195.123.45
```

**ููุงุญุธุฉ:** 
- ุงุณุชุจุฏู `C:\path\to\your-key.pem` ุจูุณุงุฑ ููู ุงูููุชุงุญ ุงูุฎุงุต ุจู
- ุงุณุชุจุฏู `YOUR_SERVER_IP` ุจู IP ุงูุณูุฑูุฑ ุงููุนูู

---

### ุงูุฎุทูุฉ 3: ุนูู ุงูุณูุฑูุฑ - ุฌูุจ ุงูุชุญุฏูุซุงุช

ุจุนุฏ ุงูุงุชุตุงู ุจุงูุณูุฑูุฑุ ุดุบู ุงูุฃูุงูุฑ ุงูุชุงููุฉ:

```bash
# 1. ุงูุงูุชูุงู ููุฌูุฏ ุงููุดุฑูุน
cd /home/ubuntu/yemen-global-delivery

# 2. ุฌูุจ ุงูุชุญุฏูุซุงุช ูู GitHub
git pull origin main

# 3. ุชุซุจูุช ุฃู dependencies ุฌุฏูุฏุฉ (ุฅู ูุฌุฏุช)
npm install --production
```

---

### ุงูุฎุทูุฉ 4: ุฅุนุงุฏุฉ ุชุดุบูู ุงูุณูุฑูุฑ

ุงุฎุชุฑ ูุงุญุฏ ูู ุงูุทุฑููุชูู:

#### ุฅุฐุง ุชุณุชุฎุฏู PM2:
```bash
# ุฅุนุงุฏุฉ ุชุดุบูู ุฌููุน ุงูุชุทุจููุงุช
pm2 restart all

# ุนุฑุถ ุญุงูุฉ ุงูุชุทุจููุงุช
pm2 status

# ุนุฑุถ ุงูู logs
pm2 logs
```

#### ุฅุฐุง ุชุณุชุฎุฏู systemd:
```bash
# ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุฏูุฉ
sudo systemctl restart oliviaship-backend

# ุงูุชุญูู ูู ุงูุญุงูุฉ
sudo systemctl status oliviaship-backend

# ุนุฑุถ ุงูู logs
sudo journalctl -u oliviaship-backend -f
```

---

### ุงูุฎุทูุฉ 5: ุงูุชุญูู ูู ูุฌุงุญ ุงููุดุฑ

```bash
# ุงุฎุชุจุงุฑ API
curl https://api.oliviaship.com/api/health

# ูุฌุจ ุฃู ุชุฑู:
# {"status":"OK","message":"Server is running",...}
```

---

## ๐ค ุงูุทุฑููุฉ ุงูุซุงููุฉ: ุงููุดุฑ ุงูุชููุงุฆู (ุฃุณุฑุน)

### ุงูุฎุทูุฉ 1: ุฑูุน ุงูุชุญุฏูุซุงุช

ุนูู ุฌูุงุฒูุ ุดุบู:
```bash
.\deploy-to-aws.bat
```

ูุฐุง ุงูุณูุฑูุจุช ุฑุงุญ:
- โ ูุญูุธ ุงูุชุบููุฑุงุช
- โ ูุฑูุนูุง ุฅูู GitHub
- โ ูุนุทูู ุงูุชุนูููุงุช ุงูุชุงููุฉ

---

### ุงูุฎุทูุฉ 2: ุงููุดุฑ ุนูู ุงูุณูุฑูุฑ

#### ุงูุทุฑููุฉ ุฃ: ูุณุฎ ุงูุณูุฑูุจุช ูุฏููุงู

1. ุงุชุตู ุจุงูุณูุฑูุฑ:
```bash
ssh -i "path\to\key.pem" ubuntu@YOUR_SERVER_IP
```

2. ุงูุณุฎ ูุญุชูู `deploy-to-aws-ssh.sh` ุฅูู ุงูุณูุฑูุฑ:
```bash
nano ~/deploy.sh
# ุงูุตู ูุญุชูู ุงูุณูุฑูุจุช
# ุงุถุบุท Ctrl+X ุซู Y ุซู Enter
```

3. ุงุฌุนู ุงูุณูุฑูุจุช ูุงุจู ููุชูููุฐ:
```bash
chmod +x ~/deploy.sh
```

4. ุดุบู ุงูุณูุฑูุจุช:
```bash
./deploy.sh
```

#### ุงูุทุฑููุฉ ุจ: ุฑูุน ุงูุณูุฑูุจุช ุนุจุฑ SCP

ูู ุฌูุงุฒู:
```bash
scp -i "path\to\key.pem" deploy-to-aws-ssh.sh ubuntu@YOUR_SERVER_IP:/home/ubuntu/
```

ุซู ุนูู ุงูุณูุฑูุฑ:
```bash
chmod +x ~/deploy-to-aws-ssh.sh
./deploy-to-aws-ssh.sh
```

---

## ๐ ุงูุชุญูู ูู ุฅุตูุงุญ ูุดููุฉ CORS

### 1. ุงูุชุญ ูููุนู ูู ุงููุชุตูุญ:
```
https://www.oliviaship.com
```

### 2. ุงูุชุญ Developer Console (F12)

### 3. ุชุญูู ูู:
- โ ุงุฎุชูุงุก ุฑุณุงูุฉ ุฎุทุฃ CORS
- โ ุชุญููู ุงูุจูุงูุงุช ุจูุฌุงุญ
- โ ุนุฏู ุธููุฑ "Failed to load settings"

### 4. ุงุฎุชุจุฑ API ูุจุงุดุฑุฉ:
```bash
curl -I https://api.oliviaship.com/api/settings
```

ูุฌุจ ุฃู ุชุฑู:
```
Access-Control-Allow-Origin: https://www.oliviaship.com
```
(ูููุฉ ูุงุญุฏุฉ ููุทุ ูููุณ ูููุชูู!)

---

## โ ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

### ูุดููุฉ: "Permission denied (publickey)"
**ุงูุญู:**
```bash
# ุชุฃูุฏ ูู ุตูุงุญูุงุช ุงูููุชุงุญ
chmod 400 path/to/your-key.pem

# ุฌุฑุจ ุงูุงุชุตุงู ูุฑุฉ ุฃุฎุฑู
ssh -i "path/to/your-key.pem" ubuntu@YOUR_SERVER_IP
```

### ูุดููุฉ: "git pull" ูุทูุจ password
**ุงูุญู:**
```bash
# ุนูู ุงูุณูุฑูุฑุ ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู HTTPS ุฃู SSH
git remote -v

# ุฅุฐุง ูุงู HTTPSุ ุบูุฑู ุฅูู SSH:
git remote set-url origin git@github.com:username/repo.git
```

### ูุดููุฉ: PM2 ุบูุฑ ููุฌูุฏ
**ุงูุญู:**
```bash
# ุชุซุจูุช PM2
sudo npm install -g pm2

# ุจุฏุก ุงูุชุทุจูู
cd /home/ubuntu/yemen-global-delivery
pm2 start server/index.js --name oliviaship-backend

# ุญูุธ ุงูุฅุนุฏุงุฏุงุช
pm2 save
pm2 startup
```

### ูุดููุฉ: ุงูุชุญุฏูุซุงุช ูุง ุชุธูุฑ
**ุงูุญู:**
```bash
# ุงูุณุญ ุงูู cache
pm2 delete all
pm2 start server/index.js --name oliviaship-backend

# ุฃู
sudo systemctl restart oliviaship-backend
```

---

## ๐ ูุฑุงูุจุฉ ุงูุณูุฑูุฑ

### ุนุฑุถ ุงูู Logs:
```bash
# PM2
pm2 logs

# systemd
sudo journalctl -u oliviaship-backend -f
```

### ูุญุต ุงุณุชุฎุฏุงู ุงูููุงุฑุฏ:
```bash
# ุงุณุชุฎุฏุงู CPU ูุงูุฐุงูุฑุฉ
pm2 monit

# ุฃู
htop
```

### ูุญุต ุญุงูุฉ Nginx:
```bash
sudo systemctl status nginx
sudo nginx -t
```

---

## ๐ ุชู ุจูุฌุงุญ!

ุงูุขู ุงูุชุญุฏูุซุงุช ููุดูุฑุฉ ุนูู ุงูุณูุฑูุฑ ููููุนู ูุดุชุบู ุจุฏูู ูุดุงูู CORS!

### ุงูุฎุทูุงุช ุงููุณุชูุจููุฉ:

ูู ูุฑุฉ ุชุจุบู ุชูุดุฑ ุชุญุฏูุซุงุช:

1. **ุนูู ุฌูุงุฒู:**
   ```bash
   git add .
   git commit -m "ูุตู ุงูุชุญุฏูุซ"
   git push origin main
   ```

2. **ุนูู ุงูุณูุฑูุฑ:**
   ```bash
   cd /home/ubuntu/yemen-global-delivery
   git pull origin main
   npm install
   pm2 restart all
   ```

3. **ุชุญูู:**
   ```bash
   pm2 logs
   curl https://api.oliviaship.com/api/health
   ```

---

## ๐ ุชุญุชุงุฌ ูุณุงุนุฏุฉุ

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ:
1. ุชุญูู ูู ุงูู logs: `pm2 logs`
2. ุชุญูู ูู ุญุงูุฉ ุงูุณูุฑูุฑ: `pm2 status`
3. ุชุญูู ูู Nginx: `sudo nginx -t`
4. ุงุฎุชุจุฑ API: `curl https://api.oliviaship.com/api/health`
